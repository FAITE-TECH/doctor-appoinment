<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <link rel="stylesheet" href="../public/css/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
  <link rel="icon" type="image/png" href="../public/assets/logo.png" />

    <title>Departments</title>
  </head>
  <body>
    <div id="header"></div>
    <script>
      fetch("shared-nav.html")
        .then((res) => res.text())
        .then((data) => {
          document.getElementById("header").innerHTML = data;
          // Initialize navigation after it's loaded
          if (window.initNavigationAfterLoad) {
            window.initNavigationAfterLoad();
          }
        });
    </script>

    <div class="relative w-full h-40 max-w-6xl mx-auto ">
            <img src="../public/assets/eyecare.jpg" alt="services" class="w-full h-full object-cover  rounded-lg">
            <h1 class="absolute bottom-2 left-2 text-xl font-bold text-white bg-black/50 px-2 py-1 rounded">
                 Services
            </h1>
        </div>


        <div class="flex text-gray-600 my-10 leading-relaxed space-x-1 text-sm mx-auto justify-center max-w-6xl ">
            <a href="home.html#doctors" class="text-blue-600 hover:underline">Home</a>
            <span>&gt;</span>
            <a href="doctors.html" class="text-blue-600 hover:underline">Departments</a>
            <span>&gt;</span>
        </div>


  <section id="services">
      <div class="text-center my-10 container mx-auto max-w-6xl px-4">
       

        <!-- Services Cards Grid -->
        <div
          id="serviceContainer"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 mt-10"
        >
          <!-- Cards will be injected by JS -->
        </div>

       
      </div>
    </section>
    <script>
      // Global variable to store departments data
      let departments = [];

      // Fetch departments from API
      async function fetchDepartments() {
        try {
          const response = await fetch('../../Backend/api/departments.php?action=public');
          const data = await response.json();
          
          if (data.status === 'success') {
            departments = data.data;
            renderDepartments();
          } else {
            console.error('Failed to fetch departments:', data.message);
            // Fallback to empty state
            const serviceContainer = document.getElementById("serviceContainer");
            serviceContainer.innerHTML = '<p class="text-center text-gray-500 col-span-full">No departments available at the moment.</p>';
          }
        } catch (error) {
          console.error('Error fetching departments:', error);
          // Fallback to empty state
          const serviceContainer = document.getElementById("serviceContainer");
          serviceContainer.innerHTML = '<p class="text-center text-gray-500 col-span-full">Unable to load departments. Please try again later.</p>';
        }
      }

      // Render departments on the page
      function renderDepartments() {
        const serviceContainer = document.getElementById("serviceContainer");
        serviceContainer.innerHTML = ''; // Clear existing content

        if (departments.length === 0) {
          serviceContainer.innerHTML = '<p class="text-center text-gray-500 col-span-full">No departments available at the moment.</p>';
          return;
        }

        departments.forEach((department) => {
          const departmentCard = document.createElement("div");
          departmentCard.className =
            "bg-white border border-gray-200 overflow-hidden shadow-sm hover:shadow-lg transition flex flex-col";

          // Use the image from database or fallback to default
          const departmentImage = department.image_path ? `/doctor-appoinment/uploads/departments/${department.image_path}` : "../public/assets/nephrology.jpg";
          const departmentName = department.name || "Department";
          const departmentDescription = department.description || "Specialized medical department providing quality healthcare services.";

          departmentCard.innerHTML = `
        <!-- Department Image Wrapper -->
        <div class="relative h-56 w-full overflow-hidden group">
          <img src="${departmentImage}" alt="${departmentName}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
        </div>

        <!-- Department Content -->
        <div class="p-6 flex flex-col justify-between flex-grow">
          <h3 class="text-xl font-semibold text-blue-800 mb-2 text-start">${departmentName}</h3>
          

          <p class="text-gray-600 text-md mb-4 clamp-4 text-start leading-relaxed">${departmentDescription}</p>

      
        </div>
      `;

          serviceContainer.appendChild(departmentCard);
        });
      }

      // Initialize when page loads
      document.addEventListener("DOMContentLoaded", () => {
        fetchDepartments();
      });
    </script>

    <!-- Footer -->
    <div id="footer"></div>
    <script>
      fetch("footer.html")
        .then((res) => res.text())
        .then((data) => {
          document.getElementById("footer").innerHTML = data;
        });
    </script>


 <!-- Placeholder for spinner -->
<div id="spinner"></div>

<script>
  // Load spinner markup
  fetch("spinner.html")
    .then(res => res.text())
    .then(data => {
      document.getElementById("spinner").innerHTML = data;

      // Now spinner is in DOM -> attach JS logic
      const spinner = document.getElementById("spinner-overlay");

      function showSpinner() {
        spinner.classList.remove("hidden");
      }
      function hideSpinner() {
        spinner.classList.add("hidden");
      }

      // Show on links
    document.querySelectorAll("a").forEach(link => {
      link.addEventListener("click", () => {
        if (link.getAttribute("href") !== "#" && !link.getAttribute("href")?.startsWith("javascript")) {
          showSpinner();
          setTimeout(hideSpinner, 10000); // works now
        }
      });
    });

    // Show on .show-spinner buttons
    document.querySelectorAll("button.show-spinner").forEach(btn => {
      btn.addEventListener("click", () => {
        showSpinner();
        setTimeout(hideSpinner, 10000); // works now
      });
    });

    // Show on form submit
    document.querySelectorAll("form").forEach(form => {
      form.addEventListener("submit", () => {
        showSpinner();
        setTimeout(hideSpinner, 10000); // works now
      });
    });

    // Optional: hide spinner after page load (auto)
    setTimeout(() => hideSpinner(), 10000);
    });
</script>

    <script src="../public/js/script.js"></script>
    <script src="shared-nav.js"></script>
  </body>
</html>
